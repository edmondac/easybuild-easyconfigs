##
# This file is an EasyBuild reciPY as per https://github.com/hpcugent/easybuild
#
# Copyright:: Copyright 2013 Dmitri Gribenko, Ward Poelmans
# Authors:: Dmitri Gribenko <gribozavr@gmail.com>
# Authors:: Ward Poelmans <wpoely86@gmail.com>
# License:: GPLv2 or later, MIT, three-clause BSD.
# $Id$
##

name = "Clang"
version = "3.6.0"

homepage = "http://clang.llvm.org/"
description = """C, C++, Objective-C compiler, based on LLVM.  Does not
 include C++ standard library -- use libstdc++ from GCC."""

# Clang also depends on libstdc++ during runtime, but this dependency is
# already specified as the toolchain.
toolchain = {'name': 'GCC', 'version': '4.9.2'}
# Do not set optarch to True: it will cause the build to fail
toolchainopts = {'optarch': False}

#source_urls = ["http://llvm.org/releases/%(version)s"]
source_urls = ["http://llvm.org/pre-releases/3.6.0/rc2/"]
sources = [
#    "llvm-%(version)src2.src.tar.xz",
    "llvm-3.6.0.tar",
    "cfe-%(version)src2.src.tar.xz",
    "compiler-rt-%(version)src2.src.tar.xz",
#    "polly-%(version)src2.src.tar.xz",
    "polly-3.6.0.tar",
]

patches = [
    # Remove some tests that fail because of -DGCC_INSTALL_PREFIX.  The issue is
    # that hardcoded GCC_INSTALL_PREFIX overrides -sysroot.  This probably breaks
    # cross-compilation.
    # http://lists.cs.uiuc.edu/pipermail/cfe-commits/Week-of-Mon-20130401/077539.html
#    'Clang-%(version)s-failing-tests-due-to-gcc-installation-prefix.patch',
#    'Clang-%(version)s-failing-sanitizer-tests.patch',
#    'Clang-%(version)s-llvm-ar-uid.patch',
#    'lit.patch',
#    ('poll-isl.patch', 'tools/polly/'),
]

builddependencies = [('CMake', '3.1.0')]

dependencies = [
    ('GMP', '6.0.0'),
    ('ISL', '0.14')
] 

sanity_check_paths = {
    'files': ['bin/clang', 'bin/clang++', 'lib/libclang.so', 'lib/clang/%(version)s/include/stddef.h'],
    'dirs': [],
}

moduleclass = 'compiler'

assertions = True

usepolly = True

build_targets = ['X86']

runtest = False

parallel = 1

bootstrap = False
